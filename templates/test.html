<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Information Search</title>
    <link rel="stylesheet" type="text/css" href="../static/style/front.css?cache_id={{ cache_id }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,500;1,500&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>
    

    <div class="title">CVE Descriptor</div>
    <div class="container">
        <form action="http://localhost:3169/search" method="post" class="search-form">
            <input type="text" id="cve_id" name="cve_id" placeholder="E.g. CVE-2017-0144">
            <input type="submit" value="Search">
        </form>
        <div class="results" id="cveResults">
            <button id="downloadPdfBtn" class="download-btn" onclick="downloadPDF()"><i class="fa-solid fa-file-arrow-down"></i></button>
            <!-- Results will be displayed here -->
            <form id="downloadForm" action="/download_pdf" method="post">
                <input type="hidden" id="htmlContent" name="html_content">
            </form>
            
             {% if info %}
             <div class="cve-info">
                {% if info.error is not defined %}
                <h3>Results for: {{ info.cve_id }}</h3>
                <p><strong>Publish Date: </strong> {{ info.publish_date }}</p>
                <p><strong>Last Modification Date:</strong> {{ info.lastmod_date }}</p>
                <p><strong>Status:</strong> {{ info.status }}</p>
                <p><strong>Description:</strong> {{ info.desc }}</p>
                <div>
                    <p><strong>CVSS Version:</strong> {{ info.version }}</p>
                    <div class="cvss-info">
                        <strong>Score:</strong> <span>{{ info.base_score }}</span>
                    </div>            
                    <p><strong>Vector String:</strong> {{ info.vector_string }}</p>
                    <div class="severity">
                        <strong>Severity:</strong> <span>{{ info.base_severity }}</span>
                    </div>
                </div>
                {% if not info.weakness == "NVD-CWE-noinfo" %}
                    <p><strong>Weaknesses:</strong> {{ info.weakness }}</p>
                {% endif %}
                <p><strong>References:</strong></p>
                <ul>
                    <li><a href="https://example.com/reference1" target="_blank">https://example.com/reference1</a></li>
                    <li><a href="https://example.com/reference2" target="_blank">https://example.com/reference2</a></li>
                </ul>
                {% else %}
                    <p>{{ info.error }}</p>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

<script>
function getScoreColor(score) {
    let bColor;
    if (score >= 9) {
        bColor = '#FF0000';
    } else if (score >= 7) {
        bColor = '#FF6600';
    } else if (score >= 4) {
        bColor = '#FFCC00';
    } else if (score >= 0) {
        bColor = '#00FF00';
    } else {
        return ['transparent', 'black'];
    }
    return [bColor, '#e6f7ff'];
}



document.addEventListener('DOMContentLoaded', function () {
    const resultsDiv = document.getElementById('cveResults');
    
    // Add dynamic score color
    const scoreElement = document.querySelector('.cvss-info span');
    if (scoreElement) {
        const score = parseFloat(scoreElement.textContent);
        [scoreElement.style.backgroundColor, scoreElement.style.color] = getScoreColor(score);
    }

    const severityElement = document.querySelector('.severity span');
    if (severityElement) {
        const severity = severityElement.textContent.trim();
        const score = parseFloat(scoreElement.textContent);
        [severityElement.style.backgroundColor, severityElement.style.color] = getScoreColor(score);
    }

    
})    
function downloadPDF() {
    // Get the dynamic content from the results container
    var resultsContainer = document.getElementsByClassName('cve-info')[0].innerHTML;
    
    // Set the hidden input's value to the results container's content
    document.getElementById('htmlContent').value = resultsContainer;

    // Submit the form to trigger the PDF download
    document.getElementById('downloadForm').submit();
}
    </script>
</body>
</html>
